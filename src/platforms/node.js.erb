var $m  = { ROOT: {} };
var JS2 = $m;

(function () {
<%= @boot   %>
<%= @parser %>
})($m);

exports.mochi = $m;

var fs = require('fs');
var requireScript = "var $m = require('mochiscript').mochi;\n";
if (require.extensions) {
  require.extensions['.ms'] = function(module, filename) {
    return $m.parse(requireScript + fs.readFileSync(filename, 'utf8'));
  };
} else if (require.registerExtension) {
  require.registerExtension('.coffee', function(content) {
    return $m.parse(requireScript + content);
  });
}
